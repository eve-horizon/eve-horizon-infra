apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
namespace: eve
patches:
  - path: api-deployment-base-patch.yaml
  - path: api-deployment-patch.yaml
  - path: agent-runtime-deployment-base-patch.yaml
  - path: agent-runtime-deployment-patch.yaml
  - path: gateway-deployment-patch.yaml
  - path: orchestrator-deployment-patch.yaml
  - path: worker-deployment-base-patch.yaml
  - path: worker-deployment-patch.yaml
  - path: api-ingress-patch.yaml
  - path: gateway-ingress-patch.yaml
  - path: registry-configmap-patch.yaml
  - path: registry-serviceaccount-patch.yaml
  - path: registry-ingress-patch.yaml
  # Delete db-migrate-job from kustomize build â€” it's a one-shot job
  # applied separately by the deploy workflow's migration step.
  - target:
      kind: Job
      name: eve-db-migrate
    patch: |
      $patch: delete
      apiVersion: batch/v1
      kind: Job
      metadata:
        name: eve-db-migrate
  - path: remove-postgres-statefulset.yaml
  - path: remove-postgres-service.yaml
  - path: remove-postgres-secret.yaml
